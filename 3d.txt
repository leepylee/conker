func main()
  num oy = -2 // M below camera
  num posz = 0
  num zsteps = 100
  num xsteps = 40
  num camerax = xsteps / 2
  
  num[] heights
  num[] cols
  for zd to zsteps // from 1M to 100M away from camera
    for xd to xsteps // from left to right
      num prevHeight = -10 // M below camera
      if zd > 0
        prevHeight = heights[(zd-1) * xsteps + xd]
      end
      num height = prevHeight + rnd(3) - 1
      add heights, height
      add cols, col(255, rnd(256), rnd(256), rnd(256))
    end
  end 
end

func num displacement(num zDiff, num xOrY)
  num ratio = xOrY / zDiff
  num disp = ratio * 1000 
  return disp
end

func draw()
  posz += 0.05
  paint BLUE
  strokewidth 3
  plot MIDX, MIDY
  style FILL
  num[] xs
  num[] ys
  for zd to zsteps // from 1M to 100M away from camera
    for xd to xsteps // from left to right
      num hy = heights[zd * xsteps + xd]
      num dispy = displacement(zd + 1 + posz, hy)
      num dispx = displacement(zd + 1 + posz, xd - camerax)
      num sx = MIDX + dispx
      num sy = MIDY + dispy
      add xs, sx
      add ys, sy
      if (zd > 0 and xd > 0)
        num prevXIndex = length(xs) - 2
        num prevZIndex = length(xs) - 1 - xsteps
        num prevXandZIndex = prevZIndex - 1
        paint cols[prevXandZIndex]
        polygon xs[prevXandZIndex], ys[prevXandZIndex], xs[prevZIndex], ys[prevZIndex], xs[prevXIndex], ys[prevXIndex], sx, sy
      end
    end
  end 
end
