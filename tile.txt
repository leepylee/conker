func main()
  num[] sprites

  num worldw = 100
  num worldh = 30
  num spritew = 16
  num spriteh = 16
  num scalex = 4
  num scaley = 4

  for x to 10
    bitmap b, spritew, spriteh
    canvasmap b
    paint 255, rnd(256), rnd(256), rnd(256)
    line 0,0,15,15
    line 0,15,15,0
    add sprites, b
  end

  num[] tiles
  for y to worldh
    for x to worldw
      add tiles, sprites[rnd(10)]
    end
  end

  num portalx 
  num portaly

  num tileh = spriteh * scaley
  num tilew = spritew * scalex

  num screenw = roundup(SCREENW / tilew) + 1
  num screenh = roundup(SCREENH / tileh) + 1

  num pixelx 
  num pixely

end

func draw()
  num ty = portaly
  num sy = 0
  num bm
  while ty < worldh and sy < screenh
    num tx = portalx
    num sx = 0
    while tx < worldw and sx < screenw
	    num b = tiles[tx + ty * worldw]
       drawbitmap b, sx * tilew - pixelx * scalex, sy * tileh - pixely * scaley, tilew, tileh
      sx++
      tx++
      bm++
    end
    sy++
    ty++
  end
  pixelx++
  if pixelx >= spritew
    portalx++
    pixelx = 0
  end
  printat 0,0,bm + " "
end
